<!DOCTYPE html>
<head>
  <title>emoji generator</title>
  <style>
  body{
    background: linear-gradient(to right,rgb(203, 75, 75),rgb(154, 41, 41));
    /* margin: 0; */
  }
  #title{
    display: flex;
    justify-content: center;
    font-family:fantasy;
    color:rgb(255, 177, 60);
    margin: 0; 
    font-size: 50px;
    /* height: 100vh; */
  }
  .emoji_gen{
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
  #emoji{
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    flex: 1 1 40%;
    max-width: 500px;
    aspect-ratio: 1/1;
    margin: auto;
    top: -10px;
    /* width: 500px;
    height: 500px; */
  }

  .meme-text {
    position: absolute; 
    font-size: 30px;
    font-weight: bold;
    text-align: center;
    color: white;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6);
    z-index: 5;
    pointer-events: none;
    width: 100%; 
  }

  #topText {
    top: -8%;
    left: 50%;
    transform: translateX(-50%);
  }

  #bottomText {
    bottom: -8%;
    left: 50%;
    transform: translateX(-50%);
  }


  .top_bottom_text {
    display: flex;
    flex-direction: column;
    gap: 5px;
    background-color: rgba(255, 255, 255, 0.05);
    padding: 10px 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    border-left: 4px solid orange;
  }

  .top_bottom_text strong {
    font-size: 20px;
    color: #ffcc66;
    margin-bottom: 5px;
  }

  .top_bottom_text input[type="text"] {
    padding: 6px 10px;
    font-size: 16px;
    background: rgb(227, 133, 133);
    color: #ffffff;
    border: 1px solid #555;
    border-radius: 4px;
    width: 100%;
    box-sizing: border-box;
  }

  #settings h2 {
    margin-top: 20px;
    margin-bottom: 10px;
    color: #ffe28a;
    font-size: 22px;
  }

  #settings label {
    margin-top: 10px;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  #emoji img{
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  }
  #Randomize {
    font-size: 30px;
    width: 50%;
    padding: 20px;
    position: relative;
    top: -120px;
    left: 350px;
    color: yellow;
    background: orange;
    cursor: pointer;
    border: none;
    border-radius: 10px;
    text-align: center;
  }
  #Randomize:hover{
    background: rgb(218, 141, 0);
  }
  #Randomize:active{
    color:red;
  }
  #emoji_output{
    background: rgb(234, 82, 82);
    display: flex;
    flex-wrap: nowrap;
    /* flex-wrap: wrap; */
    justify-content: space-between;
    /* flex-direction: row;
    align-items: center; */
    gap: 40px;
    padding: 20px;
  }
  #settings {
    display: flex; 
    width: 50%;
    max-height: 550px; 
    overflow-y: auto;  
    background: rgba(255, 255, 255, 0.1);
    padding: 20px;
    border-radius: 10px;
    color: white;
    font-family: sans-serif;
    flex-direction: column;
  }


  input[type="range"] { /*for some reason slider was getting stuck*/
  position: relative;
  width: 200px;
  z-index: 10;
  }
  #sliders_wrap{
    display: flex;
    margin: 20px;
    flex-direction: row;
  }

  #randomness_sliders,#emotion_mix {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  select{
    color:rgb(255, 177, 60);
    font-size: 30px;
    font-weight:bold;
  }
  #emotion_mix {
    display: none;
  }

  #face{
    z-index: 0;
  }

  #mouth{
    z-index: 2;
  }

  #eyebrows{
    z-index: 3;
  }

  #eyes{
    z-index: 4;
  }

  #other{
    z-index: 5;
  }
  </style>
</head>
<body>

<div class="emoji_gen">
<h1 id="title">Emoji Morpher</h1>
  <div id="emoji_output">
    <div id="emoji">
    <div class="meme-text" id="topText">Top Text</div>
    <span id="face"></span>
    <span id="mouth"></span>
    <span id="eyebrows"></span>
    <span id="eyes"></span>
    <span id="other"></span>
    <div class="meme-text" id="bottomText">Bottom Text</div>
  </div>

  <div id="settings">
    <h2>Select Emotion</h2>
    <select id="emotions">
      <option value="happy">Happy</option>
      <option value="sad">Sad</option>
      <option value="angry">Angry</option> 
      <option value="random" selected>Random</option>
    </select>

    <div id="sliders_wrap">
      <div id="randomness_sliders">
        <h2>Randomness Sliders (%)</h2>
        <div class="slider_group">
          <h4>Eyes: </h4>
          <label><span id="eyes_value">100</span>%</label>
          <input type="range" id="eyes_prob" min="0" max="100" value="100" oninput="update_label(this, 'eyes_value')">
        </div>

        <div class="slider_group">
          <h4>Eyebrows: </h4>
          <label><span id="eyeb_value">100</span>%</label>
          <input type="range" id="eyeb_prob" min="0" max="100" value="100" oninput="update_label(this, 'eyeb_value')">
        </div>

        <div class="slider_group">
          <h4>Mouth: </h4>
          <label><span id="mouth_value">100</span>%</label>
          <input type="range" id="mouth_prob" min="0" max="100" value="100" oninput="update_label(this, 'mouth_value')">
        </div>

        <div class="slider_group">
          <h4>Other: </h4>
          <label><span id="other_value">100</span>%</label>
          <input type="range" id="other_prob" min="0" max="100" value="100" oninput="update_label(this, 'other_value')">
        </div>
      </div>

      <div id="emotion_mix">
        <h2>Emotion Mix (%)</h2>
        <div class="slider_group">
          <h4>Happy: </h4>
          <label><span id="happy_value">100</span>%</label>
          <input type="range" id="happy_prob" min="0" max="100" value="100" oninput="update_label(this, 'happy_value')">
        </div>
        <div class="slider_group">
          <h4>Sad: </h4>
          <label><span id="sad_value">100</span>%</label>
          <input type="range" id="sad_prob" min="0" max="100" value="100" oninput="update_label(this, 'sad_value')">
        </div>
        <div class="slider_group">
          <h4>Angry: </h4>
          <label><span id="angry_value">100</span>%</label>
          <input type="range" id="angry_prob" min="0" max="100" value="100" oninput="update_label(this, 'angry_value')">
        </div>
      </div>
    </div>
    <button id="Randomize" onclick="rand(); randomizeCaptions();">Randomize</button>
  <h2>Emotion Captions</h2>
  <div class="top_bottom_text">
    <strong>Happy</strong><br>
    Top: <input type="text" id="custom_happy_top" value="Feeling great!"><br>
    Bottom: <input type="text" id="custom_happy_bottom" value="Keep smiling!"><br>
  </div>
  <div class="top_bottom_text">
    <strong>Sad</strong><br>
    Top: <input type="text" id="custom_sad_top" value="Not my day..."><br>
    Bottom: <input type="text" id="custom_sad_bottom" value="Feeling blue."><br>
  </div>
  <div class="top_bottom_text">
    <strong>Angry</strong><br>
    Top: <input type="text" id="custom_angry_top" value="So annoyed!"><br>
    Bottom: <input type="text" id="custom_angry_bottom" value="Back off!"><br>
  </div>
  <label>
    <input type="checkbox" id="separate_caption_random">
    Randomize top & bottom separately
  </label>
  <label>
    <input type="checkbox" id="use_random_captions">
    Use random captions (ignore custom inputs)
  </label>

  </div>

<script>
const last_chosen = {};

const em_parts = {
  happy: {
    face: 2,
    mouth: 10,
    eyes: 10,
    eyebrows: 2,
    other: 3
  },
  sad: {
    face: 2,
    mouth: 7,
    eyes: 5,
    eyebrows: 3,
    other: 2
  },
  angry: {
    face: 2,
    mouth: 1,
    eyes: 1,
    eyebrows: 2,
    other: 1
  }
};

const parts = ["face", "mouth", "eyes", "eyebrows", "other"];

function rand() {
  const eyes_prob = parseInt(document.getElementById("eyes_prob").value);
  const mouth_prob = parseInt(document.getElementById("mouth_prob").value);
  const eyebrows_prob = parseInt(document.getElementById("eyeb_prob").value);
  const other_prob = parseInt(document.getElementById("other_prob").value);
  // const emotion=document.getElementById("emotions").value;
  const emotionSelect = document.getElementById("emotions");
  const selectedEmotion = emotionSelect.value;

  const happy_mix = parseInt(document.getElementById("happy_prob").value);
  const sad_mix = parseInt(document.getElementById("sad_prob").value);
  const angry_mix = parseInt(document.getElementById("angry_prob")?.value || 0);

  const total_mix = happy_mix + sad_mix + angry_mix || 1;
  const prob_distribution = {
    happy: happy_mix / total_mix,
    sad: sad_mix / total_mix,
    angry: angry_mix / total_mix
  };

let random_i={};
for (let i = 0; i < parts.length; i++) {
  const part_id = parts[i];
  const prob = {
    eyes: eyes_prob,
    mouth: mouth_prob,
    eyebrows: eyebrows_prob,
    other: other_prob
  }[part_id] ?? 100;

  let emotion_pick;
  if (selectedEmotion !== "random") {
    emotion_pick = selectedEmotion;
  } else {
    const r = Math.random();
    if (r < prob_distribution.happy) emotion_pick = "happy";
    else if (r < prob_distribution.happy + prob_distribution.sad) emotion_pick = "sad";
    else emotion_pick = "angry";
  }

  const part_count = em_parts[emotion_pick][part_id];

  let r;
  if (prob===0 && last_chosen[part_id]!==undefined) {
    r=last_chosen[part_id];
  } else if (prob < 100) {
    const shouldRandomize = Math.random()*100<prob;
    r=shouldRandomize ? Math.floor(Math.random()*part_count):(last_chosen[part_id]??0);
  } else {
    r=Math.floor(Math.random()*part_count);
  }
  last_chosen[part_id] = r;

  const path = `emojis/${part_id}/${emotion_pick}/${r}.svg`;

  random_i[part_id] = r;
if (part_id === "other") {
  const r_m = random_i["mouth"];
  const container = document.getElementById(part_id);

  if (r_m === 4 && (r === 0 || r === 1 || r === 2)) {
    const img = document.createElement("img");
    img.src = path;
    img.alt = part_id;
    img.style.position = "absolute";
    img.style.width = "100%";
    img.style.height = "100%";

    if (r === 1) {
      img.style.zIndex = "5"; 
    } else if (r === 0) {
      img.style.zIndex = "20";
    } else if (r === 2) {
      img.style.zIndex = "15"; 
    } else {
      img.style.zIndex = "10"; 
    }

    container.innerHTML = "";
    container.appendChild(img);
  } else {
    container.innerHTML = "";
  }
}
  else 
  {
    document.getElementById(part_id).innerHTML=`<img src="${path}" alt="${part_id}"/>`;
  }
}
}

function update_label(slider, labelId) {
document.getElementById(labelId).textContent = slider.value;}



function preload_imgs() {
  for (const emotion in em_parts) {
    const parts = em_parts[emotion];
    for (const part in parts) {
      const count = parts[part];
      for (let i = 0; i < count; i++) {
        const img = new Image();
        img.src = `emojis/${part}/${emotion}/${i}.svg`;
      }
    }
  }
}

window.onload = () => {
  preload_imgs();

  const e_mix = document.getElementById("emotion_mix");
  const e_select = document.getElementById("emotions");

  function update_e_mix_visiblity() {
    e_mix.style.display = (e_select.value === "random") ? "flex" : "none";
  }

  e_select.addEventListener("change", update_e_mix_visiblity);
  update_e_mix_visiblity();

  rand();
  randomizeCaptions();
};

const captionData = {
  happy: [
    "Life is good!",
    "Sunshine and smiles!",
    "Feeling great!",
    "Best day ever!"
  ],
  sad: [
    "Not my day...",
    "Feeling blue.",
    "It'll be okay.",
    "Why does it hurt?"
  ],
  angry: [
    "Don't talk to me.",
    "Seriously!?",
    "I'm done with this.",
    "So frustrating!"
  ]
};

function getRandomCaption(emotion) {
  const captions = captionData[emotion] || [];
  return captions[Math.floor(Math.random() * captions.length)];
}

function randomizeCaptions() {
  const separate = document.getElementById("separate_caption_random").checked;
  const emotionSelect = document.getElementById("emotions");
  const allEmotions = Object.keys(captionData);

  let topEmotion, bottomEmotion;

  if (separate) {
    topEmotion = allEmotions[Math.floor(Math.random() * allEmotions.length)];
    bottomEmotion = allEmotions[Math.floor(Math.random() * allEmotions.length)];
  } else {
    let emotion = emotionSelect.value;
    if (emotion === "random") {
      emotion = allEmotions[Math.floor(Math.random() * allEmotions.length)];
    }
    topEmotion = bottomEmotion = emotion;
  }

  function getCustomOrRandom(emotion, position) {
    const useRandom = document.getElementById("use_random_captions").checked;

    if (useRandom) {
      return getRandomCaption(emotion);
    }

    const inputId = `custom_${emotion}_${position}`;
    const custom = document.getElementById(inputId);
    if (custom && custom.value.trim()) {
      return custom.value.trim();
    }

    return getRandomCaption(emotion);
  }


  let topCaption = getCustomOrRandom(topEmotion, 'top');
  let bottomCaption = getCustomOrRandom(bottomEmotion, 'bottom');

  if (topCaption === bottomCaption && topEmotion === bottomEmotion) {
    const tries = 5;
    for (let i = 0; i < tries && bottomCaption === topCaption; i++) {
      bottomCaption = getCustomOrRandom(bottomEmotion, 'bottom');
    }
  }

  document.getElementById("topText").textContent = topCaption;
  document.getElementById("bottomText").textContent = bottomCaption;
}


</script>
</body>
</html>