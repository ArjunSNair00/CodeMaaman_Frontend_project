<!DOCTYPE html>
<head>
  <title>emoji generator</title>
  <style>
  body{
    background: linear-gradient(to right,rgb(203, 75, 75),rgb(154, 41, 41));
    /* margin: 0; */
  }
  #title{
    display: flex;
    justify-content: center;
    font-family:fantasy;
    color:rgb(255, 177, 60);
    margin: 0; 
    font-size: 80px;
    /* height: 100vh; */
  }
  .emoji_gen{
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
  #emoji{
    flex: 1 1 45%;
    max-width: 500px;
    aspect-ratio: 1/1;
    position: relative;
    margin: auto;
    /* width: 500px;
    height: 500px; */
  }
  #emoji img{
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  }
  #Randomize{
    font-size: 30px;
    color:yellow;
    background: orange;
    cursor: pointer;
  }
  #Randomize:hover{
    background: rgb(218, 141, 0);
  }
  #Randomize:active{
    color:red;
  }
  #emoji_output{
    background: rgb(234, 82, 82);
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    /* flex-direction: row;
    align-items: center; */
    gap: 40px;
    padding: 20px;
  }
  #emotion_selector {
    display: flex;
    /* flex: 1 1 45%; */
    background: rgba(255, 255, 255, 0.1);
    padding: 20px;
    border-radius: 10px;
    color: white;
    font-family: sans-serif;
    flex-direction: column;
  }
    input[type="range"] { /*for some reason slider was getting stuck*/
    position: relative;
    z-index: 10;
  }
  </style>
</head>
<body>
<div class="emoji_gen">
<h1 id="title">Random Emoji Generator</h1>
  <div id="emoji_output">
    <div id="emoji">
    <span id="face"></span>
    <span id="mouth"></span>
    <span id="eyebrows"></span>
    <span id="eyes"></span>
    <span id="other"></span>
  </div>
  <div id="emotion_selector">
    <h2>Select Emotion</h2>
    <select id="emotions">
      <option value="happy">Happy</option>
      <option value="sad">Sad</option>
    </select>
    <h2>Randomness Sliders (%)</h2>

    <div class="slider_group">
      <h4>Eyes: </h4>
      <span id="eyes_value">100</span>
      <input type="range" id="eyes_prob" min="0" max="100" value="100" oninput="update_label(this, 'eyes_value')">
    </div>

    <div class="slider_group">
      <h4>Eyebrows: </h4>
      <span id="eyeb_value">100</span>
      <input type="range" id="eyeb_prob" min="0" max="100" value="100" oninput="update_label(this, 'eyeb_value')">
    </div>

    <div class="slider_group">
      <h4>Mouth: </h4>
      <span id="mouth_value">100</span>
      <input type="range" id="mouth_prob" min="0" max="100" value="100" oninput="update_label(this, 'mouth_value')">
    </div>

    <div class="slider_group">
      <h4>Other: </h4>
      <span id="other_value">100</span>
      <input type="range" id="other_prob" min="0" max="100" value="100" oninput="update_label(this, 'other_value')">
    </div>

    <button id="Randomize" onclick="rand()">Randomize</button>
    <!-- <span id="debug"></span> -->
  </div>
</div>

<script>
const last_chosen = {};
function rand() {
const eyes_prob = parseInt(document.getElementById("eyes_prob").value);
const mouth_prob = parseInt(document.getElementById("mouth_prob").value);
const eyebrows_prob = parseInt(document.getElementById("eyeb_prob").value);
const other_prob = parseInt(document.getElementById("other_prob").value);
const emotion=document.getElementById("emotions").value;
let parts=[]

if (emotion=="happy"){
parts = [ 
{id:"face",count:2},
{id:"mouth",count:9},
{id:"eyes",count:9},
{id:"eyebrows",count:2},
{id:"other",count:3}
];}

if (emotion=="sad"){
parts = [ 
{id:"face",count:2},
{id:"mouth",count:4},
{id:"eyes",count:2},
{id:"eyebrows",count:2},
{id:"other",count:1}
];}

let debug="image: ";
let random_i={};
for (let i = 0;i<parts.length;i++) {
  const part = parts[i];
  let r;
  let prob = 100;
  if (part.id==="eyes") 
    prob = eyes_prob;
  if (part.id==="mouth") 
    prob = mouth_prob;
  if (part.id==="eyebrows") 
    prob = eyebrows_prob;
  if (part.id==="other") 
    prob = other_prob;

  if (prob===0 && last_chosen[part.id]!==undefined) {
    r=last_chosen[part.id];
  } else if (prob < 100) {
    const shouldRandomize = Math.random()*100<prob;
    r=shouldRandomize ? Math.floor(Math.random()*part.count):(last_chosen[part.id]??0);
  } else {
    r=Math.floor(Math.random()*part.count);
  }
  last_chosen[part.id] = r;

  const path = `emojis/${part.id}/${emotion}/${r}.svg`;

  debug += `${path}, `;
  random_i[part.id] = r;
  if (part.id === "other") 
  {
    const r_m=random_i["mouth"];
    if (r_m===4&&(r===0||r===1||r===2)) 
    {
      document.getElementById(part.id).innerHTML=`<img src="${path}" alt="${part.id}"/>`;
    } 
    else 
    {
      document.getElementById(part.id).innerHTML="";
    }
  } 
  else 
  {
    document.getElementById(part.id).innerHTML=`<img src="${path}" alt="${part.id}"/>`;
  }
}
document.getElementById("debug").textContent=debug;
}
window.onload=rand;
function update_label(slider, labelId) {
document.getElementById(labelId).textContent = slider.value;
  }
</script>
</body>
</html>